name: 'Create Dependency Branches'
description: 'Create same branch in dependency repos to spin up that service in k8s.'

inputs:
  repos:
    description: 'Repositories to create branch on'
    default: ''
    required: false
  org:
    description: 'Organization or user to manage repos under'
    default: 'dmsi-io'
    required: false

runs:
  using: 'composite'
  steps: 

    - run: |
        echo "Using org: ${{ inputs.org }}"

        IFS=', ' read -r -a REPOS <<< "${{ inputs.repos }}"

        for REPO in "${REPOS[@]}"
        do
            echo "$REPO"
            echo "Cloning git@github.com:${{ inputs.org }}/$REPO.git"
        done

        echo "REPOS=$REPOS" >> $GITHUB_ENV
      shell: bash

    - run: git config --global url."https://nathanHotz:${{ secrets.GO_MODULES_TOKEN }}@github.com".insteadOf "https://github.com"
      shell: bash

    - uses: actions/checkout@v2
      with: 
        repository: ${{ inputs.org }}/${REPOS[0]}
        path: ${REPOS[0]}

    - run: |
        ls -al
        cd ${REPOS[0]}
        ls -al
      shell: bash